var IngrowEventGrabber=function(e){"use strict";function t(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(){var e,t,n="ingrow_events_anonymous_id",o=(t=n,window.localStorage?window.localStorage.getItem(t):(null===(t=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)"))||void 0===t?void 0:t.pop())||"");return o||(e=n,t=o=function(e){for(var t="",n=0;n<e;n++)t+=Math.random().toString(36).substr(2,e-t.length);return t}(32),window.localStorage?window.localStorage.setItem(e,t):((n=new Date).setTime(n.getTime()+31536e7),n="expires="+n.toUTCString(),document.cookie="".concat(e,"=").concat(t,"; ").concat(n))),o}var n,r,a;function i(e,t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.apiKey=e,this.projectID=t,this.apiEndpoint="https://event.ingrow.co",this.anonymousId=o(),this.ip="autofill",this.setUserID(n)}var c=(n=i,(r=[{key:"setUserID",value:function(e){this.userId=e||""}},{key:"sendEvent",value:function(e,t,n){var o=n||{},n=void 0!==(n=o.sendDeviceInfo)&&n,r=o.done,a=[];(o=function(e,t){a.push({name:e,input:t})})("session",{anonymous_id:this.anonymousId,user_id:this.userId}),o("ip",{ip:this.ip}),n&&o("device",(n=navigator.userAgent,o=window.screen,{userAgent:n,screen:{width:o.width,height:o.height}}));var t={ingrow:{stream:e,project:this.projectID},enrichment:a,event:t},i=new XMLHttpRequest;i.open("POST","".concat(this.apiEndpoint,"/v1")),i.setRequestHeader("api-key",this.apiKey),i.send(JSON.stringify(t)),i.onload=function(){r&&r(i.response)},i.onerror=function(){r&&r(null,i.response)}}}])&&t(n.prototype,r),a&&t(n,a),i);function s(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function u(o){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach(function(e){var t,n;t=o,e=r[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(r,e))})}return o}function d(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function f(e){return{path:function(e){for(var t=[];null!=e.parentNode;){for(var n=0,o=0,r=0;r<e.parentNode.childNodes.length;r++){var a=e.parentNode.childNodes[r];a.nodeName==e.nodeName&&(a===e&&(o=n),n++)}e.hasAttribute&&e.hasAttribute("id")&&""!=e.id?t.unshift(e.nodeName.toLowerCase()+"#"+e.id):1<n?t.unshift(e.nodeName.toLowerCase()+":eq("+o+")"):t.unshift(e.nodeName.toLowerCase()),e=e.parentNode}var i=t.slice(1);return i&&i.length?i.join(">"):""}(e),node_name:e.nodeName,id:e.id,class_name:e.className}}var p={};function v(o){return function(e){var t=h(e),n=t.x,t=t.y,e=e.target;p=u({is_touch:o,x:n,y:t},f(e))}}function h(e){var t,n;return(e=e||window.event).pageX||e.pageY?(t=e.pageX,n=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft,n=e.clientY+document.body.scrollTop),{x:t,y:n}}function m(a,i){return function(e){var t=h(e),n=t.x,o=t.y,r=e.target,t=n-p.x,e=o-p.y,t=Math.pow(t*t+e*e,.5)<25,e=t?i?"tap":"click":"drag",e=u(u({is_touch:i,x:n,y:o},f(r)),{},{action:e});t||(e.from=p),a(e)}}function w(e){var t=document.body.addEventListener;t("mousedown",v(e)),t("touchstart",v(e)),t("mouseup",m(e,!1)),t("touchend",m(e,!0))}function y(t){var e=window.addEventListener;e("load",function(){t({action:"load"})},{once:!0}),e("beforeunload",function(e){t({action:"leave"})}),e("unload",function(e){t({action:"leaved"})},{once:!0})}function g(o){window.onerror=function(e,t,n){o({error:e,url:t,line:n,action:"error"})}}var b=300,D=[];function I(e){for(var t=0;t<D.length;t++)D[t](e)}function O(t){A.addEventListener(t,function e(){E[t]=!0,A.removeEventListener(t,e,!1)},!1)}var E,j,S,N=window.MutationObserver||window.WebKitMutationObserver,A=document.documentElement;N?new N(I).observe(A,{childList:!0,subtree:!0}):(E={},window.addEventListener&&(O("DOMSubtreeModified"),O("DOMNodeInserted"),O("DOMNodeRemoved")),E.DOMNodeInserted?window.addEventListener("DOMContentLoaded",function(){E.DOMSubtreeModified?A.addEventListener("DOMSubtreeModified",I,!1):(A.addEventListener("DOMNodeInserted",I,!1),A.addEventListener("DOMNodeRemoved",I,!1))},!1):document.onpropertychange?document.onpropertychange=I:(j=document.getElementsByTagName("*"),S=j.length,setTimeout(function e(){var t=document.getElementsByTagName("*"),n=t.length;n!=S&&(j=[]);for(var o=0;o<n;o++)if(t[o]!==j[o]){I(),j=t,S=n;break}setTimeout(e,b)},b)));var M,L=200;function _(o){var e,t;e=function(e){var t=[],n=[];e.forEach(function(e){d(e.addedNodes).forEach(function(e){t.push(f(e))}),d(e.removedNodes).forEach(function(e){n.push(f(e))})}),o({added_nodes:t,removed_nodes:n,action:"dom-changed"})},(t=L)&&(b=t),D.push(e)}function P(s){var c=window.fetch;window.fetch=function(){var e=arguments,t=this;console.log(arguments);var n=Array.prototype.slice.call(arguments),r=n[0],n=(n[1]||{}).method,a=(a=void 0===n?"GET":n).toUpperCase(),i=Date.now();return new Promise(function(o,n){return c.apply(t,e).then(function(e){var t=e.status,n=(Date.now()-i)/1e3;s({action:"200Ajax",url:r,method:a,status:t,takenSec:n}),o(e)}).catch(function(e){var t=(Date.now()-i)/1e3;s({action:"failedAjax",url:r,method:a,status:status,takenSec:t}),n(response)})})};var e=window.XMLHttpRequest.prototype,t=e.send,n=e.open,i={};e.open=function(){var e=Array.prototype.slice.call(arguments),t=e[0],e=e[1];return i[t]=e,n.apply(this,[].slice.call(arguments))},e.send=function(){var r=Date.now(),a=this;return a.addEventListener("readystatechange",function(){var e=(Date.now()-r)/1e3,t=a.responseURL,n=i[t]||"GET",o=a.status;4==a.readyState&&200<=o&&o<300?s({action:"200Ajax",url:t,method:n,status:o,takenSec:e}):4==a.readyState&&200!=o&&s({action:"failedAjax",url:t,method:n,status:o,takenSec:e})},!1),t.apply(this,[].slice.call(arguments))}}N=c;return e.Ingrow=N,e.setIp=function(e){M.ip=e},e.setUser=function(e){M.setUser(e)},e.startEventGrabber=function(e,o){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];if(i&&!Array.isArray(i))throw"should pass an array to the middlewares";if(e&&e.projectID&&e.apiKey){var t=e.projectID,n=e.apiKey,r=e.userID;M=new(c.default||c)(n,t,void 0===r?"":r)}else{if(null==e||!e.sendEvent)throw'autoGrabber( first parameter ingrow should be an instance of Ingrow class as following\n    ingrow = new Ingrow(apiKey: "API_KEY", projectID: "PROJECT_ID", user: "" )\n\n    or contains ingrow sdk configs like bellow\n    ingrow = { apiKey: "API_KEY", projectID: "PROJECT_ID", userID: "" }';M=e}var s=[{type:"ajax",stream:"events",sendDeviceInfo:!1,waitForDom:!1,capture:P},{type:"mouse",stream:"events",sendDeviceInfo:!1,waitForDom:!0,capture:w},{type:"page",stream:"events",sendDeviceInfo:!0,waitForDom:!1,capture:y},{type:"domChange",stream:"events",sendDeviceInfo:!1,waitForDom:!0,capture:_},{type:"error",stream:"events",sendDeviceInfo:!1,waitForDom:!1,capture:g}];function a(a){s.forEach(function(e){var t=e.waitForDom,n=e.type,o=e.stream,r=e.sendDeviceInfo,e=e.capture;t===a&&e(function(e){!function t(n,o,r){n.length&&n[0](o,function(e){t(n.slice(1),e||o,r)},r)}(i,e,{type:n,stream:o,sendDeviceInfo:r})})})}o&&i.push(function(e,t,n){n=null===(n=o[n.type])||void 0===n?void 0:n.rate;n=n=-1<n?n:1,Math.random()<n&&t()}),i.unshift(function(e,t){e.page_url=window.location.pathname,t(e)}),i.push(function(e,t,n){M.sendEvent(n.stream,e,{sendDeviceInfo:n.sendDeviceInfo})}),window.addEventListener("load",function(){a(!0)}),a(!1)},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
