var IngrowEventGrabber=function(e){"use strict";function n(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(){var e,n,t,o=(t="ingrow_events_anonymous_id",window.localStorage?window.localStorage.getItem(t):(null===(t=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)"))||void 0===t?void 0:t.pop())||"");return o||(e="ingrow_events_anonymous_id",n=o=function(e){for(var n="",t=0;t<e;t++)n+=Math.random().toString(36).substr(2,e-n.length);return n}(32),window.localStorage?window.localStorage.setItem(e,n):((t=new Date).setTime(t.getTime()+31536e7),t="expires="+t.toUTCString(),document.cookie="".concat(e,"=").concat(n,"; ").concat(t))),o}var t,r,i;function a(e,n,t){(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")})(this,a),this.apiKey=e,this.projectID=n,this.apiEndpoint="https://event.ingrow.co",this.anonymousId=o(),this.ip="autofill",this.setUserID(t)}var s=(t=a,(r=[{key:"setUserID",value:function(e){this.userId=e||""}},{key:"sendEvent",value:function(e,n,t){var o=t||{},t=o.sendDeviceInfo,r=o.done,i=[];(o=function(e,n){i.push({name:e,input:n})})("session",{anonymous_id:this.anonymousId,user_id:this.userId}),o("ip",{ip:this.ip}),void 0!==t&&t&&o("device",(t=navigator.userAgent,o=window.screen,{userAgent:t,screen:{width:o.width,height:o.height}}));var n={ingrow:{stream:e,project:this.projectID},enrichment:i,event:n},a=new XMLHttpRequest;a.open("POST","".concat(this.apiEndpoint,"/v1")),a.setRequestHeader("api-key",this.apiKey),a.send(JSON.stringify(n)),a.onload=function(){r&&r(a.response)},a.onerror=function(){r&&r(null,a.response)}}}])&&n(t.prototype,r),i&&n(t,i),a);function c(n,e){var t,o=Object.keys(n);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(n),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),o.push.apply(o,t)),o}function u(o){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach(function(e){var n,t;n=o,e=r[t=e],t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(r,e))})}return o}function d(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return f(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?f(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}function l(e){return{path:function(e){for(var n=[];null!=e.parentNode;){for(var t=0,o=0,r=0;r<e.parentNode.childNodes.length;r++){var i=e.parentNode.childNodes[r];i.nodeName==e.nodeName&&(i===e&&(o=t),t++)}e.hasAttribute&&e.hasAttribute("id")&&""!=e.id?n.unshift(e.nodeName.toLowerCase()+"#"+e.id):1<t?n.unshift(e.nodeName.toLowerCase()+":eq("+o+")"):n.unshift(e.nodeName.toLowerCase()),e=e.parentNode}var a=n.slice(1);return a&&a.length?a.join(">"):""}(e),node_name:e.nodeName,id:e.id,class_name:e.className}}var p={};function v(o){return function(e){var n=m(e),t=n.x,n=n.y,e=e.target;p=u({is_touch:o,x:t,y:n},l(e))}}function m(e){var n,t;return(e=e||window.event).pageX||e.pageY?(n=e.pageX,t=e.pageY):(e.clientX||e.clientY)&&(n=e.clientX+document.body.scrollLeft,t=e.clientY+document.body.scrollTop),{x:n,y:t}}function h(i,a){return function(e){var n=m(e),t=n.x,o=n.y,r=e.target,n=t-p.x,e=o-p.y,n=Math.pow(n*n+e*e,.5)<25,e=n?a?"tap":"click":"drag",e=u(u({is_touch:a,x:t,y:o},l(r)),{},{action:e});n||(e.from=p),i(e)}}function g(e){var n=document.body.addEventListener;n("mousedown",v(e)),n("touchstart",v(e)),n("mouseup",h(e,!1)),n("touchend",h(e,!0))}function y(n){document.addEventListener("DOMContentLoaded",function(){n({action:"load"})},{once:!0});var e=window.addEventListener;e("beforeunload",function(e){n({action:"leaving"})}),e("unload",function(e){n({action:"leaved"})},{once:!0})}function w(o){window.onerror=function(e,n,t){o({error:e,url:n,line:t,action:"error"})}}var b=300,I=[];function O(e){for(var n=0;n<I.length;n++)I[n](e)}function D(n){_.addEventListener(n,function e(){E[n]=!0,_.removeEventListener(n,e,!1)},!1)}var E,j,N,M=window.MutationObserver||window.WebKitMutationObserver,_=document.documentElement;M?new M(O).observe(_,{childList:!0,subtree:!0}):(E={},window.addEventListener&&(D("DOMSubtreeModified"),D("DOMNodeInserted"),D("DOMNodeRemoved")),E.DOMNodeInserted?window.addEventListener("DOMContentLoaded",function(){E.DOMSubtreeModified?_.addEventListener("DOMSubtreeModified",O,!1):(_.addEventListener("DOMNodeInserted",O,!1),_.addEventListener("DOMNodeRemoved",O,!1))},!1):document.onpropertychange?document.onpropertychange=O:(j=document.getElementsByTagName("*"),N=j.length,setTimeout(function e(){var n=document.getElementsByTagName("*"),t=n.length;t!=N&&(j=[]);for(var o=0;o<t;o++)if(n[o]!==j[o]){O(),j=n,N=t;break}setTimeout(e,b)},b)));var L,S=200;function P(o){var e,n;e=function(e){var n=[],t=[];e.forEach(function(e){d(e.addedNodes).forEach(function(e){n.push(l(e))}),d(e.removedNodes).forEach(function(e){t.push(l(e))})}),o({added_nodes:n,removed_nodes:t,action:"dom-changed"})},(n=S)&&(b=n),I.push(e)}M=s;return e.Ingrow=M,e.setIp=function(e){L.ip=e},e.setUser=function(e){L.setUser(e)},e.startEventGrabber=function(e,o){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];if(r&&!Array.isArray(r))throw"should pass an array to the middlewares";if(e&&e.projectID&&e.apiKey){var n=e.projectID,t=e.apiKey,i=e.userID;L=new(s.default||s)(t,n,void 0===i?"":i)}else{if(null==e||!e.sendEvent)throw'autoGrabber( first parameter ingrow should be an instance of Ingrow class as following\n    ingrow = new Ingrow(apiKey: "API_KEY", projectID: "PROJECT_ID", user: "" )\n\n    or contains ingrow sdk configs like bellow\n    ingrow = { apiKey: "API_KEY", projectID: "PROJECT_ID", userID: "" }';L=e}e=[{type:"mouse",stream:"events",sendDeviceInfo:!1,capture:g},{type:"page",stream:"events",sendDeviceInfo:!0,capture:y},{type:"domChange",stream:"events",sendDeviceInfo:!1,capture:P},{type:"error",stream:"events",sendDeviceInfo:!1,capture:w}],o&&r.push(function(e,n,t){t=null===(t=o[t.type])||void 0===t?void 0:t.rate;t=t=-1<t?t:1,Math.random()<t&&n()}),r.unshift(function(e,n){e.page_url=window.location.pathname,n(e)}),r.push(function(e,n,t){L.sendEvent(t.stream,e,{sendDeviceInfo:t.sendDeviceInfo})}),e.forEach(function(e){var n=e.type,t=e.stream,o=e.sendDeviceInfo;(0,e.capture)(function(e){!function n(t,o,r){t.length&&t[0](o,function(e){n(t.slice(1),e||o,r)},r)}(r,e,{type:n,stream:t,sendDeviceInfo:o})})})},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
